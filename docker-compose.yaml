services:
  # Go HTMX Application Service
  web:
    build:
      context: . # Build context is the project root (where go.mod, internal/, static/, etc. are)
      dockerfile: ./Dockerfile # Path to the Dockerfile for the web service
    ports:
      - "8080:8080" # Map host port 8080 to container port 8080
    environment:
      # Environment variables for your Go application
      # These will be accessible via os.Getenv() in your Go code
      DATABASE_URL: "postgres://user:password@db:5432/mydatabase?sslmode=disable"
      APP_PORT: "8080"
    depends_on:
      - db # Ensures the 'db' service starts before 'web'
    # Set entrypoint to run migrations before starting the app (example)
    # entrypoint: ["/bin/sh", "-c", "/app/web-app migrate up && /app/web-app"]

  # PostgreSQL Database Service
  db:
    image: postgres:16-alpine # Using the official PostgreSQL image
    environment:
      # Required environment variables for the PostgreSQL image
      POSTGRES_DB: mydatabase
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    volumes:
      # Persistent volume for database data
      # Data will persist even if the container is removed
      - db-data:/var/lib/postgresql/data
    ports:
      - "5432:5432" # Optional: Expose DB port to host for local access (e.g., via GUI tool)

volumes:
  db-data: # Define the named volume for database persistence
