{{ block "index" .}}
<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../../../static/css/styles.css" />
  <title>My Expense Trackers</title>
</head>

<body>
  <header class="header-section">
    <!-- Theme Toggle Button -->
    <button id="theme-toggle">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="sun">
        <circle cx="12" cy="12" r="4" />
        <path d="M12 2v2" />
        <path d="M12 20v2" />
        <path d="M4.93 4.93l1.41 1.41" />
        <path d="M17.66 17.66l1.41 1.41" />
        <path d="M2 12h2" />
        <path d="M20 12h2" />
        <path d="M6.34 17.66l-1.41 1.41" />
        <path d="M19.07 4.93l-1.41 1.41" />
      </svg>
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="moon">
        <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
      </svg>
      <span>Toggle Theme</span>
    </button>
    <h3>Expense Tracker</h3>
    <nav class="tracker-navigation">
      <button class="tracker-nav-button" hx-get="/home" hx-target="#tracker-content" hx-push-url="/home"
        data-path="/home">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
          <polyline points="9 22 9 12 15 12 15 22" />
        </svg>
        Home
      </button>
      <button class="tracker-nav-button" hx-get="/car" hx-target="#tracker-content" hx-push-url="/car" data-path="/car">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 17H5a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2Z" />
          <circle cx="7" cy="17" r="2" />
          <circle cx="17" cy="17" r="2" />
        </svg>
        Car
      </button>
    </nav>
  </header>
  <div class="container">
    <!-- Main Content Area for Loaded Trackers -->
    <!-- This is where HTMX will swap the content for different trackers -->
    <div id="tracker-content">
      <!-- Initial content for the landing page, or default tracker overview -->
      {{ template "index-content" . }}
    </div>
  </div>
  <footer>
    <p>&copy; 2025 My Expense Trackers Suite. All rights reserved.</p>
  </footer>
  <dialog id="dialog-modal" hx-on::after-swap="document.getElementById('dialog-modal').showModal()"></dialog>
  <!-- End of .container -->

  <!-- HTMX script must be loaded after the body content -->
  <script src="../,,/../static/js/htmx.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Theme Toggle Logic (Copied from previous version)
      const themeToggle = document.getElementById("theme-toggle");
      const body = document.body;

      const setTheme = (theme) => {
        if (theme === "dark") {
          body.classList.add("dark");
          localStorage.setItem("theme", "dark");
        } else {
          body.classList.remove("dark");
          localStorage.setItem("theme", "light");
        }
      };

      const savedTheme = localStorage.getItem("theme");
      if (savedTheme) {
        setTheme(savedTheme);
      } else if (
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches
      ) {
        setTheme("dark");
      } else {
        setTheme("light");
      }

      themeToggle.addEventListener("click", () => {
        if (body.classList.contains("dark")) {
          setTheme("light");
        } else {
          setTheme("dark");
        }
      });

      // Tracker Navigation Button Active State Logic
      const trackerNavButtons = document.querySelectorAll(
        ".tracker-nav-button",
      );

      const setActiveTrackerNavButton = (path) => {
        trackerNavButtons.forEach((button) => {
          const buttonPath = button.getAttribute("data-path");
          if (buttonPath === path) {
            button.classList.add("active");
          } else {
            button.classList.remove("active");
          }
        });
      };

      // Set initial active button based on current URL path
      // Default to '/home-utilities' if it's the root or no specific path
      const initialTrackerPath =
        window.location.pathname === "/"
          ? "/home-utilities"
          : window.location.pathname;
      setActiveTrackerNavButton(initialTrackerPath);

      // HTMX event listeners for updating active button state
      document.body.addEventListener("htmx:afterSwap", (event) => {
        // This event fires after HTMX has swapped content and updated the URL
        setActiveTrackerNavButton(window.location.pathname);
      });

      document.body.addEventListener("htmx:historyCacheMiss", (event) => {
        // This event fires when navigating through browser history and HTMX needs to re-request content
        setActiveTrackerNavButton(window.location.pathname);
      });

      // Initial load of content (optional, to load Home Utilities by default)
      // You might want to trigger the first HTMX request on page load
      // For example, simulate a click on the 'Home Utilities' button if the path is '/'
      if (window.location.pathname === "/") {
        const homeUtilitiesButton = document.querySelector(
          '.tracker-nav-button[data-path="/home-utilities"]',
        );
        if (homeUtilitiesButton) {
          // Trigger the HTMX request
          htmx.trigger(homeUtilitiesButton, "click");
        }
      }
    });
  </script>
</body>

</html>
{{ end }}
